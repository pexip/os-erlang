diff --git a/lib/crypto/c_src/crypto.c b/lib/crypto/c_src/crypto.c
index c781ccb..326846e 100644
--- a/lib/crypto/c_src/crypto.c
+++ b/lib/crypto/c_src/crypto.c
@@ -472,14 +472,18 @@ static ERL_NIF_TERM md5_final(ErlNifEnv* env, int argc, const ERL_NIF_TERM argv[
 
 static ERL_NIF_TERM sha(ErlNifEnv* env, int argc, const ERL_NIF_TERM argv[])
 {/* (Data) */    
+    EVP_MD_CTX ctx;
     ErlNifBinary ibin;
     ERL_NIF_TERM ret;
 
     if (!enif_inspect_iolist_as_binary(env, argv[0], &ibin)) {
 	return enif_make_badarg(env);
     }
-    SHA1((unsigned char *) ibin.data, ibin.size,
-	 enif_make_new_binary(env,SHA_LEN, &ret));
+    EVP_MD_CTX_init(&ctx);
+    EVP_DigestInit_ex(&ctx, EVP_sha1(), NULL);
+    EVP_DigestUpdate(&ctx, ibin.data, ibin.size);
+    EVP_DigestFinal_ex(&ctx, enif_make_new_binary(env, SHA_LEN, &ret), NULL);
+    EVP_MD_CTX_cleanup(&ctx);
     return ret;
 }
 static ERL_NIF_TERM sha_init(ErlNifEnv* env, int argc, const ERL_NIF_TERM argv[])
